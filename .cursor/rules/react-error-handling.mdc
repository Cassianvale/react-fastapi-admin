# React é”™è¯¯å¤„ç†ç³»ç»Ÿè§„èŒƒ

## ğŸ¯ é”™è¯¯å¤„ç†ç­–ç•¥

æœ¬é¡¹ç›®é‡‡ç”¨å®Œå–„çš„é”™è¯¯å¤„ç†ç³»ç»Ÿï¼Œé€šè¿‡ç»Ÿä¸€çš„é”™è¯¯åˆ†ç±»å’Œå¤„ç†æœºåˆ¶ï¼Œæä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒã€‚

### é”™è¯¯ç±»å‹åˆ†ç±»

#### 1. ä¸šåŠ¡é”™è¯¯ (BUSINESS_ERROR)

- **å®šä¹‰**: ä¸šåŠ¡é€»è¾‘ç›¸å…³çš„é”™è¯¯ï¼Œå¦‚è¡¨å•éªŒè¯å¤±è´¥ã€æ•°æ®å†²çªç­‰
- **HTTP çŠ¶æ€ç **: 400, 422, 409, 412
- **å¤„ç†æ–¹å¼**: æ˜¾ç¤ºå…·ä½“çš„é”™è¯¯æ¶ˆæ¯ç»™ç”¨æˆ·

#### 2. ç½‘ç»œé”™è¯¯ (NETWORK_ERROR)

- **å®šä¹‰**: ç½‘ç»œè¿æ¥å¤±è´¥ã€è¯·æ±‚è¶…æ—¶ç­‰ç½‘ç»œå±‚é¢çš„é”™è¯¯
- **ç‰¹å¾**: æ²¡æœ‰ response å¯¹è±¡
- **å¤„ç†æ–¹å¼**: æ˜¾ç¤ºç½‘ç»œé”™è¯¯æç¤º

#### 3. è®¤è¯é”™è¯¯ (AUTH_ERROR)

- **å®šä¹‰**: è®¤è¯å’Œæˆæƒç›¸å…³çš„é”™è¯¯
- **HTTP çŠ¶æ€ç **: 401, 403
- **å¤„ç†æ–¹å¼**: æ¸…é™¤è®¤è¯ä¿¡æ¯ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µ

#### 4. ç³»ç»Ÿé”™è¯¯ (SYSTEM_ERROR)

- **å®šä¹‰**: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ã€ç½‘å…³é”™è¯¯ç­‰ç³»ç»Ÿçº§é”™è¯¯
- **HTTP çŠ¶æ€ç **: 500, 502, 503, 504
- **å¤„ç†æ–¹å¼**: æ˜¾ç¤ºç³»ç»Ÿé”™è¯¯æç¤ºï¼Œå¯é€‰æ‹©ä¸ŠæŠ¥é”™è¯¯

## ğŸ”§ æ ¸å¿ƒå·¥å…·å’Œ Hooks

### 1. useErrorHandler Hook

å‚è€ƒ: [react-web/src/hooks/useErrorHandler.js](mdc:react-web/src/hooks/useErrorHandler.js)

```jsx
import { useErrorHandler } from '@/hooks/useErrorHandler';

const MyComponent = () => {
  const { handleError, handleBusinessError, showSuccess } = useErrorHandler();

  const handleSubmit = async (values) => {
    try {
      await api.submitForm(values);
      showSuccess("æäº¤æˆåŠŸï¼");
    } catch (error) {
      // è‡ªåŠ¨è¯†åˆ«é”™è¯¯ç±»å‹å¹¶å¤„ç†
      handleError(error, "æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•");
    }
  };

  return (
    // ç»„ä»¶å†…å®¹
  );
};
```

### 2. é”™è¯¯å¤„ç†å·¥å…·å‡½æ•°

å‚è€ƒ: [react-web/src/utils/errorHandler.js](mdc:react-web/src/utils/errorHandler.js)

```jsx
import {
  getErrorType,
  getErrorMessage,
  handleError,
} from "@/utils/errorHandler";

// é”™è¯¯ç±»å‹åˆ¤æ–­
const errorType = getErrorType(error);

// é”™è¯¯æ¶ˆæ¯æå–
const message = getErrorMessage(error);

// ç»Ÿä¸€é”™è¯¯å¤„ç†
handleError(error, defaultMessage);
```

### 3. é”™è¯¯å¤„ç†åˆå§‹åŒ–

å‚è€ƒ: [react-web/src/utils/errorInit.js](mdc:react-web/src/utils/errorInit.js)

```jsx
// åœ¨åº”ç”¨å¯åŠ¨æ—¶åˆå§‹åŒ–å…¨å±€é”™è¯¯å¤„ç†
import { initErrorHandling } from "@/utils/errorInit";

// åœ¨ main.jsx ä¸­è°ƒç”¨
initErrorHandling();
```

## ğŸ“ ä½¿ç”¨æŒ‡å—

### 1. åŸºç¡€é”™è¯¯å¤„ç†

```jsx
const UserForm = () => {
  const { handleError, showSuccess } = useErrorHandler();

  const onSubmit = async (values) => {
    try {
      const result = await userApi.create(values);
      showSuccess("ç”¨æˆ·åˆ›å»ºæˆåŠŸï¼");
      return result;
    } catch (error) {
      handleError(error, "åˆ›å»ºç”¨æˆ·å¤±è´¥");
    }
  };

  return <Form onFinish={onSubmit}>{/* è¡¨å•å†…å®¹ */}</Form>;
};
```

### 2. ä¸šåŠ¡é”™è¯¯å¤„ç†

```jsx
const DataTable = () => {
  const { handleBusinessError } = useErrorHandler();

  const onDelete = async (id) => {
    try {
      await api.delete(id);
    } catch (error) {
      // ä¸“é—¨å¤„ç†ä¸šåŠ¡é€»è¾‘é”™è¯¯
      handleBusinessError(error, {
        400: "è¯·æ±‚å‚æ•°é”™è¯¯",
        409: "è¯¥æ•°æ®æ­£åœ¨è¢«ä½¿ç”¨ï¼Œæ— æ³•åˆ é™¤",
        422: "æ•°æ®éªŒè¯å¤±è´¥"
      });
    }
  };

  return (
    // è¡¨æ ¼ç»„ä»¶
  );
};
```

### 3. è‡ªå®šä¹‰é”™è¯¯å¤„ç†å™¨

```jsx
const FileUpload = () => {
  const { handleError } = useErrorHandler();

  const customErrorHandler = (error) => {
    if (error.code === 'FILE_TOO_LARGE') {
      message.error('æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶');
    } else if (error.code === 'UNSUPPORTED_FORMAT') {
      message.error('ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼');
    } else {
      handleError(error, 'æ–‡ä»¶ä¸Šä¼ å¤±è´¥');
    }
  };

  const onUpload = async (file) => {
    try {
      await uploadApi.upload(file);
    } catch (error) {
      customErrorHandler(error);
    }
  };

  return (
    // ä¸Šä¼ ç»„ä»¶
  );
};
```

### 4. å…¨å±€é”™è¯¯è¾¹ç•Œ

```jsx
import React from "react";
import { Result, Button } from "antd";

class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false, error: null };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true, error };
  }

  componentDidCatch(error, errorInfo) {
    console.error("Error Boundary æ•è·åˆ°é”™è¯¯:", error, errorInfo);
    // å¯ä»¥åœ¨è¿™é‡Œä¸ŠæŠ¥é”™è¯¯åˆ°ç›‘æ§ç³»ç»Ÿ
  }

  render() {
    if (this.state.hasError) {
      return (
        <Result
          status="500"
          title="é¡µé¢å‡ºç°é”™è¯¯"
          subTitle="æŠ±æ­‰ï¼Œé¡µé¢å‘ç”Ÿäº†æ„å¤–é”™è¯¯ã€‚"
          extra={
            <Button type="primary" onClick={() => window.location.reload()}>
              åˆ·æ–°é¡µé¢
            </Button>
          }
        />
      );
    }

    return this.props.children;
  }
}
```

## ğŸŒ HTTP è¯·æ±‚é”™è¯¯å¤„ç†

### 1. è¯·æ±‚æ‹¦æˆªå™¨

å‚è€ƒ: [react-web/src/utils/request.js](mdc:react-web/src/utils/request.js)

```jsx
// è¯·æ±‚æ‹¦æˆªå™¨ - æ·»åŠ è®¤è¯ä¿¡æ¯
request.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem("token");
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);
```

### 2. å“åº”æ‹¦æˆªå™¨

```jsx
// å“åº”æ‹¦æˆªå™¨ - ç»Ÿä¸€é”™è¯¯å¤„ç†
request.interceptors.response.use(
  (response) => {
    return response;
  },
  (error) => {
    // è®¤è¯é”™è¯¯å¤„ç†
    if (error.response?.status === 401) {
      localStorage.removeItem("token");
      window.location.href = "/login";
      return Promise.reject(error);
    }

    // å…¶ä»–é”™è¯¯äº¤ç»™ç»„ä»¶å¤„ç†
    return Promise.reject(error);
  }
);
```

## ğŸš¨ é”™è¯¯ä¸ŠæŠ¥å’Œç›‘æ§

### 1. é”™è¯¯æ—¥å¿—è®°å½•

```jsx
const logError = (error, context = {}) => {
  const errorLog = {
    message: error.message,
    stack: error.stack,
    timestamp: new Date().toISOString(),
    url: window.location.href,
    userAgent: navigator.userAgent,
    context,
  };

  // å‘é€åˆ°ç›‘æ§æœåŠ¡
  console.error("Error Log:", errorLog);

  // å¯ä»¥é›†æˆ Sentryã€LogRocket ç­‰ç›‘æ§æœåŠ¡
};
```

### 2. æ€§èƒ½ç›‘æ§

```jsx
const trackApiPerformance = (apiName, startTime, error = null) => {
  const endTime = performance.now();
  const duration = endTime - startTime;

  const performanceLog = {
    api: apiName,
    duration,
    timestamp: new Date().toISOString(),
    success: !error,
    error: error?.message,
  };

  console.log("API Performance:", performanceLog);
};
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. é”™è¯¯å¤„ç†åŸåˆ™

- **ç”¨æˆ·å‹å¥½**: å‘ç”¨æˆ·æ˜¾ç¤ºå¯ç†è§£çš„é”™è¯¯ä¿¡æ¯
- **å¼€å‘è€…å‹å¥½**: åœ¨æ§åˆ¶å°è®°å½•è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- **ä¸€è‡´æ€§**: ä½¿ç”¨ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æ¨¡å¼
- **å¯æ¢å¤æ€§**: æä¾›é”™è¯¯æ¢å¤æœºåˆ¶

### 2. é”™è¯¯æ¶ˆæ¯è§„èŒƒ

- é¿å…æŠ€æœ¯æœ¯è¯­ï¼Œä½¿ç”¨ç”¨æˆ·èƒ½ç†è§£çš„è¯­è¨€
- æä¾›å…·ä½“çš„è§£å†³å»ºè®®
- ä¿æŒæ¶ˆæ¯ç®€æ´æ˜äº†
- æ”¯æŒå›½é™…åŒ–

### 3. é”™è¯¯å¤„ç†æµ‹è¯•

- æ¨¡æ‹Ÿå„ç§é”™è¯¯åœºæ™¯
- æµ‹è¯•é”™è¯¯å¤„ç†çš„ç”¨æˆ·ä½“éªŒ
- éªŒè¯é”™è¯¯è¾¹ç•Œçš„å·¥ä½œæƒ…å†µ
- ç¡®ä¿é”™è¯¯ä¸ä¼šå¯¼è‡´åº”ç”¨å´©æºƒ

### 4. é”™è¯¯æ¢å¤ç­–ç•¥

- æä¾›é‡è¯•æœºåˆ¶
- æ”¯æŒç¦»çº¿æ¨¡å¼
- è‡ªåŠ¨æ¢å¤è¿æ¥
- ä¿å­˜ç”¨æˆ·è¾“å…¥æ•°æ®
